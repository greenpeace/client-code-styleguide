/**
 * @name		p3-styleguide
 * @version		v0.3.0
 * @date		2014-02-17
 * @copyright	Copyright 2013, Greenpeace International
 * @source		https://github.com/greenpeace/p3_styleguide
 * @license magnet:?xt=urn:btih:1f739d935676111cfff4b4693e3816e664797050&dn=gpl-3.0.txt GPL-v3-or-Later */
"use strict";!function(a,b){var c=a.p3||(a.p3={}),d={delimiter:"|"};c.autofill=function(c,e){var f=a(c),g=a.extend(!0,d,e),h=b.location.href.split("#")[0];a.each(a.p3.request(h).parameters,function(b,c){if(c.indexOf(g.delimiter)>0){var d=a(':checkbox:nameNoCase("'+b+'")',f);a.each(c.split(g.delimiter),function(a,b){d.filter(':valueNoCase("'+b+'")').prop("checked",!0)})}else a(':radio:nameNoCase("'+b+'")',f).filter(':valueNoCase("'+c+'")').prop("checked",!0),a(':input:nameNoCase("'+b+'")',f).val(c),a(':input:selectNoCase("'+b+'")',f).val(c)})}}(jQuery,this),function(){function a(){}window.console||(window.console={});for(var b=["log","info","warn","error","debug","trace","dir","group","groupCollapsed","groupEnd","time","timeEnd","profile","profileEnd","dirxml","assert","count","markTimeline","timeStamp","clear"],c=0;c<b.length;c++)window.console[b[c]]||(window.console[b[c]]=a)}(),function(a,b,c){var d=a.p3||(a.p3={}),e="$.p3.form_tracking :: ",f="undefined"==typeof b._gaq?[]:b._gaq;d.form_tracking=function(b){f.length||console.warn(e+"Google Analytics not found");var d=a(b),g=d.is(":input")?d:a(":input",d),h=d.closest("form").attr("id");if(!h)throw new Error(e+"Form "+b+" not found, aborting");g.blur(function(){var b=a(this),d=b.attr("name");d!==c&&f.push(g.val().length>0?["_trackEvent",h,"completed",d]:["_trackEvent",h,"skipped",d])})}}(jQuery,this),function(a,b){var c=a.p3||{};c.mobilesearchform=function(c){function d(b){var c;b.matches?(c=a("#main-nav .search-form").detach(),a(".heading-first .tools").append(c)):(c=a(".heading-first .tools .search-form").detach(),a("#nav").before(c))}c||(c=768);var e=parseInt(c,10);if("undefined"!=typeof b.matchMedia&&e){var f=b.matchMedia("(min-width: "+e+"px)");f.addListener(d),d(f)}},a.p3=c}(jQuery,this),function(a,b,c){var d=a.p3||{},e={el:"body",sizes:{threetwo:320,four:400,five:500,six:600,sixfive:650,seven:700,sevensome:768,eightfive:850,nine:900,tablet:480,desktop:1024,wide:1350,large:1600},onResize:!0,onLoad:!0,delay:100};d.narrow=function(d){function f(){return"number"==typeof b.innerWidth?b.innerWidth:c.documentElement&&c.documentElement.clientWidth?c.documentElement.clientWidth:void 0}function g(){var b="",c=f();a.each(i.sizes,function(a,d){c>=d?b+=" "+a:k.removeClass(a)}),k.addClass(b)}function h(a,b){l||(l=!0,setTimeout(function(){l=!1},b),a())}var i=a.extend(!0,e,d||{}),j=a(b),k=a(i.el),l=!1;i.onResize&&j.resize(function(){h(g,i.delay)}),i.onLoad&&j.ready(g)},a.p3=d}(jQuery,this,document),$(document).ready(function(){Modernizr.input.placeholder||$("#SearchText").focus(function(){var a=$(this);a.val()===a.attr("placeholder")&&(a.val(""),a.removeClass("placeholder"))}).blur(function(){var a=$(this);(""===a.val()||a.val()===a.attr("placeholder"))&&(a.addClass("placeholder"),a.val(a.attr("placeholder")))}).blur().parents("form").submit(function(){$(this).find("[placeholder]").each(function(){var a=$(this);a.val()===a.attr("placeholder")&&a.val("")})})}),function(a,b,c,d){var e=a.p3||{},f={meterElement:".completed",meterWrapper:"#action-counter-graphical",textElement:"#action-counter-textual",fetchFrequency:3e4,updateSpeed:25,initialAnimationTotalDuration:2500,dataElement:"body",dataNamespace:"pledgeData",externalTrigger:!0,fetchDataEvent:"pledgeCounterFetch",fetchCompleteEvent:"fetchPledgeDataComplete",jsonURL:"https://secured.greenpeace.org/international/en/api/v2/pledges/",params:{},timeout:3e4,abortOnError:!1};e.pledge_counter=function(e,g){var h=a.extend(!0,f,g||{}),i=a(h.meterElement,e),j=a(h.textElement,e),k=!1,l=0,m=0,n={count:0,target:0},o=a.p3.request(h.jsonURL),p="$.p3.pledge_counter :: ",q=function(){if(k)return void setTimeout(function(){q()},h.fetchFrequency);k=!0;var a=n.count;l>a&&(l=0),m=Math.ceil(a*h.updateSpeed/h.initialAnimationTotalDuration,0),0>=m&&(m=1),j.text(s(n.count)+" have joined so far. The target is "+s(n.target)+"."),r()},r=function(){if(l>=1*n.count)return k=!1,void(h.externalTrigger||setTimeout(u,h.fetchFrequency));l+m<n.count?l+=m:l=n.count;var a=l/n.target*100;a>100&&(a=100),b.csstransforms?i.css({width:a+"%"}).html(s(l)+"&nbsp;"):i.animate({width:a+"%"},h.updateSpeed-5>=0?h.updateSpeed:0,function(){i.html(s(l)+"&nbsp;")}),setTimeout(r,h.updateSpeed)},s=function(a){for(var b=a+"",c=b.split("."),d=c[0],e=c.length>1?"."+c[1]:"",f=/(\d+)(\d{3})/;f.test(d);)d=d.replace(f,"$1,$2");return d+e},t=function(){var b=a(h.dataElement).data(h.dataNamespace);if(b&&"error"!==b.status&&b.pledges[0].action){if(n.count=b.pledges[0].action.count,n.target=b.pledges[0].action.target,isNaN(n.count)||isNaN(n.target))return console.warn(p+"Progress data not found or not valid, attempting to continue"),!1;a(h.meterWrapper).show(),q()}else if(h.abortOnError)throw new Error(p+"Errors in pledge data:",b)},u=function(){var b=a.extend(!0,o.parameters,h.params);a.support.cors=!0,a.ajax({url:o.url,timeout:h.timeout,dataType:"json",data:b}).success(function(b){a(h.dataElement).data(h.dataNamespace,b)}).fail(function(a){var b=p+'Failed to load "'+o.url+'"';if(h.abortOnError)throw new Error(b,a);console.warn(b,a)}).always(function(){a.event.trigger(h.fetchCompleteEvent)})};b.load({test:c.JSON,nope:["dist/js/compat/json.min.js"],complete:function(){b.csstransforms&&i.css({"transition-duration":h.updateSpeed+"ms"}),a(d).on(h.fetchDataEvent,function(){u()}),a(d).on(h.fetchCompleteEvent,function(){t()}),h.externalTrigger===!1&&a.event.trigger(h.fetchDataEvent)}})},a.p3=e}(jQuery,Modernizr,this,document),function(a,b,c){var d=a.p3||{},e={emailField:"#UserEmail",identifyUserBy:"email",registrationFields:"#action-form-register",exceptionFields:"#action-form-message, #action-smallprints",signerCheckURL:"https://secured.greenpeace.org/international/en/api/v2/pledges/signercheck/",validateForm:!0,validationRulesURL:"https://secured.greenpeace.org/international/en/api/v2/pledges/validation/",animationDuration:350,disableOnError:!1,params:{},showSummary:!1,messageElement:'<div class="message"></div>'};a.expr[":"].p3_empty=function(b){var d=a(b);return d.attr("name")===c?!1:""===d.val()},d.pledge_with_email_only=function(f,g){var h=a.extend(!0,e,g||{}),i=a(f),j=i.is("form")?i:a("form",i),k=a(h.emailField),l=a("input[type=submit]",j),m=[],n=a.p3.request(h.signerCheckURL),o="$.p3.pledge_with_email_only :: ",p={url:n.url,parameters:a.extend(!0,n.parameters,h.params)},q=function(){if(p.parameters.page===c&&p.parameters.action===c)throw new Error(o+"Page or Action identifier not found")},r=function(){switch(h.identifyUserBy){case"email":p.parameters.user=k.val();break;case"uuid":throw new Error(o+"uuid not implemented");default:throw new Error(o+"config.identifyUserBy: "+h.identifyUserBy+" invalid")}},s=function(){p.parameters.expire===c&&console.warn(o+"No expiry date set")},t=function(b){l.prop("disabled","disabled").addClass("disabled"),m[b]={checked:!1},a.getJSON(p.url,p.parameters,function(c){if(m[b].checked=!0,l.removeProp("disabled").removeClass("disabled"),"success"===c.status)w(),u(b);else switch(c.error.code){case 1:throw new Error(o+"Invalid Key");case 2:case 3:case 4:case 5:throw console.error(c.error),new Error(o+"Invalid parameters: ",p.parameters);case 13:var d=k.parents(".email:first"),e=a(".message",d);e.length||(d.append(h.messageElement),e=a(".message",d)),e.append('<span class="error" for="'+k.attr("id")+'">'+c.error.pledge.unique+"</span>"),k.addClass("error");break;case 15:a(".first-time",j).show(h.animationDuration),x();break;case 16:a(".first-time",j).html("<p>Welcome back!<br/>We just need a little more information for this pledge</p>").show(h.animationDuration),v(c.user);break;default:console.warn("Unhandled error code: "+c.error.code,c.error)}}).fail(function(){if(h.disableOnError)throw new Error("$.p3.pledge_with_email_only.js :: Signer API request failed");console.warn(o+"Failed to load JSON, all form inputs re-enabled"),x(),l.removeProp("disabled").removeClass("disabled")})},u=function(b){a(window).trigger("submit_"+b)},v=function(b){console.log(o+"showMissingFields"),a.each(b,function(c){if(b[c]===!1){var d=a('div:classNoCase("'+c+'")',j),e=a(":input",d);e?(e.removeProp("disabled"),d.show(h.animationDuration)):console.warn(o+""+c+" not found")}})},w=function(){a(h.registrationFields+" > :not("+h.exceptionFields+", #action-submit-full)").hide().find(":input").removeClass("error").prop("disabled","disabled")},x=function(){a(h.registrationFields+" > :not("+h.exceptionFields+", #action-submit-full)").show(h.animationDuration).find(":input").removeProp("disabled")},y=function(){w(),q(),s(),a(":input[type!=submit]",j).keypress(function(b){if(13===b.which){var c=a(this);return c.is("textarea")?!0:(b.preventDefault(),a(this).blur(),l.focus().click(),!1)}}),l.click(function(b){r(),p.parameters.user?m[p.parameters.user]&&m[p.parameters.user].checked?a(window).trigger("submit_"+p.parameters.user):(b.preventDefault(),w(),k.valid()?(a(window).on("submit_"+p.parameters.user,function(){j.submit()}),t(p.parameters.user)):j.submit()):j.submit()}),h.validateForm&&a.p3.validation(j,{jsonURL:h.validationRulesURL,params:p.parameters,debug:!0,showSummary:h.showSummary,disableOnError:h.disableOnError})};b.load({test:window.JSON,nope:["dist/js/compat/json.min.js"],complete:y}),a.p3=d}}(jQuery,Modernizr),function(a,b,c,d){var e=a.p3||{},f={jsonURL:"https://secured.greenpeace.org/international/en/api/v2/pledges/",params:{},timeSelector:".since",timeDataAttr:"data-since",countrySelector:"#UserCountry",externalTrigger:!1,dataElement:"body",dataNamespace:"pledgeData",fetchDataEvent:"recentSignersFetch",fetchCompleteEvent:"fetchPledgeDataComplete",updateInterval:3e4,userQueueInterval:750,maxUsers:5,maxRefreshes:30,timeout:3e4,abortOnError:!1};e.recent_signers=function(e,g){var h=a.extend(!0,f,g),i=a(e),j=!1,k=a.p3.request(h.jsonURL),l=[],m=!1,n=0,o="$.p3.recent_signers :: ",p={running:!1,delay:h.userQueueInterval,actions:[],callback:function(){},step:function(){if(p.actions.length)try{p.actions.pop()()}catch(a){console.log(a)}else p.running=!1},run:function(){p.running=!0,p.actions.length?(p.step(),setTimeout(p.run,p.delay)):(p.running=!1,p.callback())}},q=function(){if(p.running)return clearTimeout(m),m=setTimeout(function(){q()},h.updateInterval),!1;var b=a.extend(!0,k.parameters,h.params);a.support.cors=!0,a.ajax({url:k.url,timeout:h.timeout,dataType:"json",data:b}).success(function(b){a(h.dataElement).data(h.dataNamespace,b)}).fail(function(a,b,c){var d=o+'Failed to load "'+k.url+'"';if(h.abortOnError)throw new Error(d,a);console.error(d),console.error(a),console.error(b),console.error(c)}).always(function(){a.event.trigger(h.fetchCompleteEvent)})},r=function(){var b=a(h.dataElement).data(h.dataNamespace);if(n++<h.maxRefreshes&&!h.externalTrigger&&p.actions.push(function(){clearTimeout(m),m=setTimeout(function(){a.event.trigger(h.fetchDataEvent)},h.updateInterval)}),!b||"error"===b.status){if(h.abortOnError)throw new Error(o+"JSON data invalid");return void p.run()}a.each(b.pledges,function(a,b){return l[b.user.id]?!1:(l[b.user.id]=!0,b.user.dont_display_name===!0?(console.warn(o+"pledge.user.dont_display_name is true"),!0):void p.actions.push(function(){u(b.user)}))}),p.actions.push(function(){v()}),p.run()},s=function(b){return b?a.timeago(b):void 0},t=function(b){var c=a(h.countrySelector+" option:valueNoCase("+b+")").text();return c?c:h.abortOnError?"":b},u=function(b){var c=a('<li style="display:none"><span class="since" data-since="'+b.created+'">'+s(b.created)+'</span><span class="icon flag '+b.country+'"></span><span class="name">'+b.firstname+" "+b.lastname+'</span> <span class="country">'+t(b.country)+"</span></li>");j.prepend(c),c.show(350),h.maxUsers&&a("li",j).length>h.maxUsers&&a("li:last",j).hide(350).remove()},v=function(){a(h.timeSelector,j).each(function(){var b=a(this);b.text(s(b.attr(h.timeDataAttr)))})};h.updateInterval<5e3&&(h.updateInterval=5e3),j=a("ul:first",i),j.length||(j=a("<ul></ul>"),i.append(j)),b.load({test:c.JSON,nope:["js/vendor/json.min.js"],complete:function(){v(),a(d).on(h.fetchDataEvent,function(){q()}),a(d).on(h.fetchCompleteEvent,function(){r()}),h.externalTrigger||a.event.trigger(h.fetchDataEvent)}})},a.p3=e}(jQuery,Modernizr,this,document),function(a,b){var c=a.p3||{},d={rememberMeSelector:"#RememberMe",emailSelector:"#UserEmail",cookieName:"email",expires:31,secure:"https"===window.location.protocol||"https"===document.location.protocol?!0:!1,keepRememberMeState:!0};c.remember_me_cookie=function(c,e){var f=a.extend(!0,d,e||{}),g=a(c).is("form")?a(c):a("form:first",c),h=a(f.rememberMeSelector,g).first(),i=a(f.emailSelector,g).first(),j=f.keepRememberMeState&&b.localstorage?!0:!1;a.cookie.defaults={expires:f.expires,secure:f.secure},i.val(a.cookie(f.cookieName)),g.submit(function(){h.is(":checked")?a.cookie(f.cookieName,i.val()):a.removeCookie(f.cookieName),j&&(localStorage.rememberMeGP=h.is(":checked")?"true":"false")}),j&&"undefined"!==localStorage.rememberMeGP&&h.prop("checked","true"===localStorage.rememberMeGP?!0:!1)},a.p3=c}(jQuery,Modernizr),function(a){var b=a.p3||{};b.request=function(a){var b={url:!1,parameters:!1},c=[],d=function(){var a={};return c[1]&&c[1].split(/[&;]/g).forEach(function(b){var c=b.split(/\=/);c.length>1&&c[0].length&&c[1].length&&(a[c[0]]=c[1])}),a},e=function(){return c[0].length?c[0]:a};return a?(c=a.split("?"),b.url=e(),b.parameters=d(),b):b},a.p3=b}(jQuery),function(a){a.expr[":"].classNoCase=function(b,c,d){var e=a(b).attr("class"),f=d[3];return f&&e?e.toUpperCase().indexOf(f.toUpperCase())>=0:!1},a.expr[":"].nameNoCase=function(b,c,d){var e=a(b).attr("name"),f=d[3];return f&&e?e.toUpperCase().indexOf(f.toUpperCase())>=0:!1},a.expr[":"].selectNoCase=function(b,c,d){var e=a("option",b).val()||"",f=d[3];return f&&e.length?e.toUpperCase().indexOf(f.toUpperCase())>=0:!1},a.expr[":"].valueNoCase=function(b,c,d){var e=a(b).val()||"",f=d[3];return f&&e.length?e.toUpperCase().indexOf(f.toUpperCase())>=0:!1}}(jQuery),function(a,b,c){var d=a.p3||{},e=function(){return(new Date).getTime()+" :: $.p3.social_sharing :: "}(),f={pageURL:!1,popup:{top:200,left:100,width:550,height:350},networks:{facebook:{enabled:!0,url:"http://www.facebook.com/sharer.php?u=__REFERRER__",count:0},twitter:{enabled:!0,url:"https://twitter.com/intent/tweet?original_referer=__REFERRER__&source=tweetbutton&text=__TITLE__&url=__REFERRER__&via=__ACCOUNT__",count:0,title:!1,account:"greenpeace"},google:{enabled:!0,url:"https://plus.google.com/share?url=__REFERRER__",count:0},linkedin:{enabled:!0,url:"https://www.linkedin.com/cws/share?url=__REFERRER__&original_referer=__REFERRER__",count:0},pinterest:{enabled:!0,url:"http://pinterest.com/pin/create/button/?url=__REFERRER__&media=__IMAGE__&description=__DESCRIPTION__",count:0,image:!1,description:!1}},precision:1,jsonURL:"https://www.greenpeace.org/api/p3/pledge/social.json"};d.social_sharing=function(d,g){function h(a){for(var b=a+"",c=b.split("."),d=c[0],e=c.length>1&&1*c[1]>0&&100>a?"."+c[1].replace(/0+$/,""):"",f=/(\d+)(\d{3})/;f.test(d);)d=d.replace(f,"$1,$2");return d+e}function i(a){if(a=1*a,1e4>a)return h(a);for(var b=["","K","M","G","T","P","E"],c=a,d=0;c>1e3;)c/=1e3,d++;return h(1*c.toFixed(k.precision))+b[d]}function j(){k.pageURL===!1&&(console.warn(e+'page referrer URL is not set, using "'+c.location.href+'"'),k.pageURL=c.location.href),a.each(k.networks,function(b,d){if(d.enabled!==!1){var f=a("li."+b,l),g=a(".counter span",f),h=a("a",f),j=d.url;switch(b){case"pinterest":d.image===!1&&(console.warn(e+"Pinterest sharing requires an image."),d.image=""),d.description===!1&&(console.warn(e+"Pinterest sharing requires a description."),d.description=""),j=j.replace("__IMAGE__",encodeURIComponent(d.image)),j=j.replace("__DESCRIPTION__",encodeURIComponent(d.description));break;case"twitter":d.title===!1&&(console.warn(e+"Twitter sharing requires a title."),d.title=""),j=j.replace("__TITLE__",encodeURIComponent(d.title)),j=j.replace("__ACCOUNT__",encodeURIComponent(d.account))}j=j.replace(/__REFERRER__/g,encodeURIComponent(k.pageURL)),h.attr({href:j,target:"_blank"}).click(function(a){a.preventDefault(),c.open(j,"Share this page","left="+k.popup.left+",top="+k.popup.top+",width="+k.popup.width+",height="+k.popup.height+",toolbar=0,resizable=1")}),g.text(i(d.count))}})}var k=a.extend(!0,f,g||{}),l=a(d);b.load({test:c.JSON,nope:["dist/js/compat/json.min.js"],complete:function(){a.getJSON(k.jsonURL,function(b){if(a.extend(!0,k,b),"success"!==b.status)throw console.warn(b),new Error(e+"Status: "+b.status+": server reported a problem");j()}).fail(function(){throw new Error(e+'Failed to load JSON: "'+k.jsonURL+'"')})}})},a.p3=d}(jQuery,Modernizr,this),function(a,b,c){var d=a.p3||{},e={jsonURL:"https://www.greenpeace.org/api/p3/pledges",rules:{},tests:{alphaPlus:"^[\\p{L}\\p{N}\\.\\-\\'\\,\\/]+$",numeric:"^\\p{N}+$",alpha:"^\\p{L}+$",url:"^((([A-Za-z]{3,9}:(?:\\/\\/)?)(?:[-;:&=\\+\\$,\\w]+@)?[A-Za-z0-9.-]+|(?:www.|[-;:&=\\+\\$,\\w]+@)[A-Za-z0-9.-]+)((?:\\/[\\+~%\\/.\\w-_]*)?\\??(?:[-\\+=&;%@.\\w_]*)#?(?:[\\w]*))?)$"},autoSign:!1,onfocusout:!1,onkeyup:!1,showSummary:!1,summarySelector:".errorSummary",summaryElement:'<div class="errorSummary message"></div>',disableOnError:!1,errorElement:"span",errorPlacement:function(b,c){var d=a(c),e=d.prop("name").toUpperCase();d.parents(":classNoCase("+e+")").find("div.message").html(b)},params:{},animationDuration:250,messageElement:'<div class="message"></div>'};a.validator.addMethod("valueNotEquals",function(a,b,c){return c!==a},"Value must not equal arg."),d.validation=function(d,f){var g=a.extend(!0,e,f||{}),h=a.p3.request(g.jsonURL),i={url:h.url,parameters:a.extend(!0,h.parameters,g.params)},j=a.p3.request(c.location.href).parameters,k=a(d),l=k.is("form")?k:a("form",d),m=g.messageElement,n="$.p3.validation.js :: ",o=function(){a(":input",l).removeProp("disabled").removeClass("disabled")},p=function(){a(":input",l).prop("disabled","disabled").addClass("disabled")},q=function(){if(g.disableOnError&&p(),g.showSummary){a(g.summarySelector,k).length||k.prepend(g.summaryElement);var b=a(g.summarySelector).first();g.errorPlacement=function(){},g.invalidHandler=function(a,c){var d,e=c.numberOfInvalids();d=1===e?"Oops, there was a problem on 1 field.<br/>It has been highlighted below":"Oops, there was a problem on "+e+" fields.<br/>They have been highlighted below",setTimeout(function(){b.html('<span class="error">'+d+"</span>"),b.show(g.animationDuration)},100)},a(":input[type=submit]",l).on("click",function(){b.hide().html("")})}a.each(g.tests,function(b,c){try{a.validator.addMethod(b,function(a,b){var d=new XRegExp(c,"i");return this.optional(b)||d.test(a)})}catch(d){console.warn(n+"Failed to add test '"+b+"' with regex '"+c+"'"),console.warn(d)}}),a(":input",l).each(function(){var b=a(this),c=b.prop("name"),d=c?b.parents(":classNoCase("+c+")").first():!1;d?d.find("div.message").length||d.append(m):b.is("[type=submit]")||console.warn(n+'"'+c+'" field parent not found')}),o(),l.validate(g),(g.autoSign||"true"===j.auto_sign||"1"===j.auto_sign)&&(a.p3.pledge_with_email_only?a("input[type=submit]",l).click():l.submit())};i.url?b.load({test:c.JSON,nope:["dist/js/compat/json.min.js"],complete:function(){a.support.cors=!0,a.getJSON(i.url,i.parameters,function(b){g=a.extend(!0,g,b)}).fail(function(){if(console.warn(n+"JSON failed to load from: "+g.jsonURL),g.disableOnError)throw p(),new Error(n+"Form input disabled");console.warn(n+"Attempting to continuing regardless...")}).complete(function(){q()})}}):q()},a.p3=d}(jQuery,Modernizr,this);
// @license-end