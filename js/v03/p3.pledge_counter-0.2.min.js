!function(a,b,c,d){"use strict";var e=a.p3||{},f={meterElement:".completed",textElement:"#action-counter-textual",fetchFrequency:3e4,updateSpeed:25,initialAnimationTotalDuration:2500,dataElement:"body",dataNamespace:"pledgeCounter",eventDriven:!1,fetchDataEvent:"fetchPledgeData",fetchCompleteEvent:"fetchPledgeDataComplete",jsonURL:"https://www.greenpeace.org/api/p3/pledge/config.json",params:{}};e.pledge_counter=function(e,g){var h=a.extend(!0,f,g||{}),i=a(h.meterElement,e),j=a(h.textElement,e),k=!1,l=0,m=0,n={count:0,target:0},o=a.p3.request(h.jsonURL),p=function(){if(k)return setTimeout(function(){p()},h.fetchFrequency),void 0;k=!0;var a=n.count;l>a&&(l=0),m=Math.ceil(a*h.updateSpeed/h.initialAnimationTotalDuration,0),0>=m&&(m=1),j.text(r(n.count)+" have joined so far. The target is "+r(n.target)+"."),q()},q=function(){if(l>=1*n.count)return k=!1,void 0;l+m<n.count?l+=m:l=n.count;var a=100*(l/n.target);a>100&&(a=100),b.csstransforms?i.css({width:a+"%"}).html(r(l)+"&nbsp;"):i.animate({width:a+"%"},h.updateSpeed-5>=0?h.updateSpeed:0,function(){i.html(r(l)+"&nbsp;")}),setTimeout(q,h.updateSpeed)},r=function(a){for(var b=a+"",c=b.split("."),d=c[0],e=c.length>1?"."+c[1]:"",f=/(\d+)(\d{3})/;f.test(d);)d=d.replace(f,"$1,$2");return d+e},s=function(b){var c=d===b?a(h.dataElement).data(h.dataNamespace):b;if(!c||"error"===b.status||!c.pledges[0].action)throw console.log("ERROR"),a.each(b.errors,function(a,b){console.log(a+" => "+b)}),new Error("Errors in pledge data.");return n.count=c.pledges[0].action.count,n.target=c.pledges[0].action.target,isNaN(n.count)||isNaN(n.target)?(console.log("ERROR: progress data not found, aborting."),!1):(p(),void 0)},t=function(){var b=a.extend(!0,o.parameters,h.params);a.getJSON(o.url,b,function(a){s(a)}).error(function(a){throw new Error(a)})};return b.load({test:c.JSON,nope:["js/v03/lib/json.min.js"],complete:function(){b.csstransforms&&i.css({"transition-duration":h.updateSpeed+"ms"}),h.eventDriven?(a(c).on(h.fetchDataEvent,function(){t()}),a(c).on(h.fetchCompleteEvent,function(){s()})):t()}}),{config:h,parseJSON:s,fetchJSON:t}},a.p3=e}(jQuery,Modernizr,this);